# Workflow для развертывания Docker-образа

Этот workflow GitHub Actions автоматизирует процесс сборки и развертывания Docker-образа в GitHub Container Registry (GHCR) при изменениях, отправленных в ветку `master`, или при ручном запуске.

## Обзор Workflow

Workflow выполняет следующие шаги:

1. **Триггер:**
   - Workflow запускается либо вручную через диспетчериацию (`workflow_dispatch`), либо при изменениях ветки `master`.

2. **Конкурентность и Права:**
   - Workflow использует конкурентность с именем `build-and-push`.
   - Требует прав на чтение содержимого репозитория и запись пакетов.

3. **Настройка среды:**
   - Настраивает переменные среды для конфигурации, включая реестр Docker-образов (`REGISTRY`), тег образа (`TAG_NAME`) и имя образа кэша (`CACHE_IMAGE_NAME`).

4. **Выполнение задачи:**
   - Задача выполняется на виртуальной машине с операционной системой `ubuntu-latest` с таймаутом 5 минут.

5. **Шаги:**
   - **Получение Кода:**
     - Использует `actions/checkout@v3` для получения последней версии кода.
   - **Экспорт Имен Образов в Нижнем Регистре:**
     - Экспортирует имена образов в нижнем регистре (`IMAGE_TAG` и `CACHE_TAG`) для использования позже в workflow.
   - **Вход в GHCR:**
     - Использует `docker/login-action@v2` для аутентификации и входа в GitHub Container Registry с использованием предоставленного токена GitHub.
   - **Настройка Docker Buildx:**
     - Настраивает Docker Buildx с использованием `docker/setup-buildx-action@v2`.
   - **Сборка и Отправка:**
     - Использует `docker/build-push-action@v3` для сборки Docker-образа, присвоения ему тега указанного реестра и отправки в GHCR. Также используется кэширование для ускорения сборки.

## Использование

1. **Ручной Запуск:**
   - Чтобы вручную запустить workflow, перейдите во вкладку "Actions" в вашем репозитории GitHub, выберите "Deploy Docker image" из списка workflow и нажмите кнопку "Run workflow".

2. **Автоматический Запуск:**
   - Workflow автоматически запускается при изменениях, отправленных в ветку `master`.

3. **Настройка:**
   - Настройте переменные среды, такие как `REGISTRY`, `TAG_NAME` и `CACHE_IMAGE_NAME`, в зависимости от требований вашего проекта.

4. **GitHub Container Registry:**
   - Убедитесь, что ваш Docker-образ правильно помечен и отправлен в GHCR. Образ будет доступен по адресу `ghcr.io/OWNER/REPO:latest`.

## Права и Безопасность

- Workflow использует токен GitHub (`secrets.GITHUB_TOKEN`) для аутентификации, обеспечивая безопасный доступ к GitHub Container Registry.
- Просмотрите и адаптируйте права в соответствии с вашими конкретными требованиями к безопасности и доступу.

## Примечание

- Этот workflow предполагает, что ваш Dockerfile находится в корне репозитория. Измените параметры `context` и `file` в шаге "Сборка и Отправка", если ваш Dockerfile находится в другом месте.
